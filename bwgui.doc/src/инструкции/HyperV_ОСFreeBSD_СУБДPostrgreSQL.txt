/*Как конфигурировать виртуальную машину на Hyper-V с ОС FreeBSD и СУБД PostrgreSQL

1) создаем стандартуную виртуальную машину на Hyper-V. Настройки:
- ОП 1024
- задаем обязательно пдключение в настройках сети - буем тянуть дистрибутивы с портов
- HDD 10ГБ
- в качестве диска с ОС указываем iso файл с последним дистрибутивом  ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/10.3/
	я выбирал FreeBSD-10.3-RELEASE-amd64-dvd1.iso
-сетевой адаптер в созданной машине на устаревший не меняем - чего бы там не говорил google.

2) Запускаем созданную виртуальную машину и устанавливаем ОС
 - выбираем Install
 - continue with default keymap
 - задаем имя сервера
 - в distribution select оставляем только lib32 и ports
 - в Partitioning выбираем Auto (UFS), далее Entire Disk, далее GPT, Finish, Commit - ждем
 - задем пароль root
 - создаем сетевое подключени:
	* активируем ipv4
	* используем DHCP
	* IPV6 не активировал
	* в Network Configuration ничего не менял. Должен появится IPV4 DNS 1 - признак того что сетевая карта настроена нормально
	* задем временную зону Asia->Russian Federation->Moscow+04
- в system configuration оставляем как есть
- пользоветля можно не создавать, будем работать под root
- далее Exit - ждем
- в Manual Configuration выбираме Yes - см пункт 3

3) Настраиваваем сеть - смотрим как называется сетвая карта:
	ifconfig

	увидим как мимнмум два устройства 
	lo0 - это петля
	hn0 или de0 (может называться по другому) - это то что надо 

   правим файл /etc/rc.conf
	- набираем edit /etc/rc.conf
	- меняем DHCP на SYNCDHCP для сетевой которая показалась в ifconfig
		ifconfig_hn0="SYNCDHCP"
	
   	- жмем esc и сохранем изменения
        - набирем exit 
        - перегружаем машину - выбираме reboot, при ребуте вытаскиваем установовчный диск. Иногда чтоб вытащить диск надо выключить виртуальную машину.

4) проверяем что dhclient запускается автоматически и доступен internet
 	ping www.ya.ru

	подробнее про dhclient тут https://www.freebsd.org/doc/ru/books/handbook/network-dhcp.html

5) Обновляем порты - выполняем команды
	portsnap fetch
	portsnap extract
	

6) устанавливаем PostgreSQL (https://wiki.postgresql.org/wiki/Detailed_installation_guides)
	- установка через порты:
		* набираем команду cd /usr/ports/databases
		* сморим что есть из postgresql набираем команду ls postgresql*
		* заходим в каталог cd postgresql[ВЕРСИЯ]-server
		* инсталируем
			make install clear
		* прописываем автозапуск
			echo 'postgresql_enable="YES"' >> /etc/rc.conf
		* инициализируем 
			/usr/local/etc/rc.d/postgresql initdb
		* запускаем вручную
			/usr/local/etc/rc.d/postgresql start 
		* меняем пароль пользователелю pgsql 
			passwd pgsql 
		* выходим из root и заходим под pgsql
			logout
		* добавляем БД под pgsql
			$ /usr/local/bin/createdb mydb
		* Подключаемся к БД
			$ /usr/local/bin/psql mydb
			и меняем пароль pgsql
			ALTER USER pgsql WITH PASSWORD ‘pgsql’;
			
		* создаем test пользователя для БД			
			mydb=# create user tester with password 'mypassword';
		*выходим из клиента БД
			\q 
		* разрешаем подключатся к БД по сети:
			# правим файл 
				edit /usr/local/pgsql/data/pg_hba.conf
				Добавляем в него строку
					host all all 192.168.1.0/24 md5
					!!!маску подсети ставим свою
			# правим файл 
				edit /usr/local/pgsql/data/postgresql.conf
					раскоментарить и отредактировать строку 
					listen_addresses='*'
			
			# перезапускаем сервер 
			# подключаемся с помощью утилиты pgadmin под pgsql
				host = ip сервера
				port = 5432
				Обслуживание DB = postgres
				имя польховтаеля = pgsql
				пароль = pgsql
				
			

			
*/

			


	

	

